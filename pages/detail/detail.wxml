<view class="container" data-theme="{{theme}}" data-elder="{{elderMode}}" style="background: var(--color-background); min-height: 100vh;">
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æˆ¿æºå†…å®¹ -->
  <view class="detail-container" wx:else>
    
    <!-- è½®æ’­å›¾åŒºåŸŸ -->
    <view class="swiper-container">
      <swiper class="swiper" circular autoplay interval="3000" duration="500" indicator-dots indicator-color="rgba(255,255,255,0.5)" indicator-active-color="#ffffff">
        <block wx:for="{{house.images}}" wx:key="index">
          <swiper-item>
            <image class="slide-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}"></image>
          </swiper-item>
        </block>
      </swiper>
      
      <!-- ä»·æ ¼æ ‡ç­¾ -->
      <view class="price-tag" wx:if="{{house.price}}">
        <text class="price">Â¥{{house.price}}</text>
        <text class="unit">/{{house.unit || 'æ™š'}}</text>
      </view>
      
      <!-- å›¾ç‰‡è®¡æ•° -->
      <view class="image-count" wx:if="{{house.images}}">{{house.images.length}}å¼ </view>
    </view>
    
    <!-- æ ‡é¢˜åŒºåŸŸå¡ç‰‡ -->
    <view class="card">
      <view class="title-section">
        <view class="title-left">
          <text class="title">{{house.title || 'æˆ¿æºæ ‡é¢˜'}}</text>
          <view class="rating" wx:if="{{house.rating}}">
            <text class="star">â­</text>
            <text class="score">{{house.rating}}</text>
            <text class="comment-count">({{house.commentCount || 0}}æ¡è¯„ä»·)</text>
          </view>
        </view>
        <view class="title-right">
          <view class="favorite-btn" bindtap="onFavorite">
            <text class="favorite-icon">{{house.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="favorite-text">{{house.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
          </view>
        </view>
      </view>
      
      <!-- ä½ç½® -->
      <view class="location-section" bindtap="onMap">
        <text class="location-icon">ğŸ“</text>
        <text class="address">{{house.location || 'æœªçŸ¥ä½ç½®'}}</text>
        <text class="distance" wx:if="{{house.distance}}">{{house.distance}}</text>
        <text class="map-link">æŸ¥çœ‹åœ°å›¾ â€º</text>
      </view>
    </view>
    
    <!-- å…¥ä½ä¿¡æ¯å¡ç‰‡ -->
    <view class="card">
      <view class="card-header">
        <text class="card-title">å…¥ä½ä¿¡æ¯</text>
      </view>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">å…¥ä½</text>
          <text class="info-value">15:00å</text>
        </view>
        <view class="info-item">
          <text class="info-label">é€€æˆ¿</text>
          <text class="info-value">12:00å‰</text>
        </view>
        <view class="info-item">
          <text class="info-label">æœ€å°‘å…¥ä½</text>
          <text class="info-value">1å¤©</text>
        </view>
        <view class="info-item">
          <text class="info-label">æœ€å¤šå…¥ä½</text>
          <text class="info-value">4äºº</text>
        </view>
      </view>
    </view>
    
    <!-- è®¾æ–½æ ‡ç­¾å¡ç‰‡ -->
    <view class="card" wx:if="{{house.facilities && house.facilities.length > 0}}">
      <view class="card-header">
        <text class="card-title">è®¾æ–½æœåŠ¡</text>
      </view>
      <view class="facilities-grid">
        <view class="facility-grid-item" wx:for="{{house.facilities}}" wx:key="index">
          <text class="facility-icon">{{facilityIcons[index] || 'âœ“'}}</text>
          <text class="facility-name">{{item}}</text>
        </view>
      </view>
    </view>
    
    <!-- æˆ¿ä¸œä¿¡æ¯å¡ç‰‡ -->
    <view class="card" wx:if="{{house.host}}">
      <view class="card-header">
        <text class="card-title">æˆ¿ä¸œä¿¡æ¯</text>
      </view>
      <view class="host-info">
        <image class="host-avatar" src="{{house.host.avatar || 'https://picsum.photos/100/100'}}" mode="aspectFill"></image>
        <view class="host-detail">
          <view class="host-name">
            <text>{{house.host.name || 'æˆ¿ä¸œ'}}</text>
            <identity-badge wx:if="{{house.host.identity}}" identity="{{house.host.identity}}"></identity-badge>
          </view>
          <text class="host-desc">{{house.host.desc || 'æ•°å­—æ¸¸æ°‘ç¤¾åŒºä¸»ç†äºº'}}</text>
          <view class="host-stats">
            <text>å›å¤ç‡ 100%</text>
            <text>|</text>
            <text>5åˆ†é’Ÿå›å¤</text>
          </view>
        </view>
        <button class="contact-btn" bindtap="onContact">è”ç³»æˆ¿ä¸œ</button>
      </view>
    </view>
    
    <!-- æˆ¿æºä»‹ç»å¡ç‰‡ -->
    <view class="card">
      <view class="card-header">
        <text class="card-title">æˆ¿æºä»‹ç»</text>
      </view>
      <text class="description">{{house.description || 'æš‚æ— ä»‹ç»'}}</text>
    </view>
    
    <!-- ===== ä¼˜åŒ–åçš„è¯„ä»·å¡ç‰‡ ===== -->
    <view class="card reviews-card">
      <view class="card-header">
        <view class="header-left">
          <text class="card-title">æˆ¿å®¢è¯„ä»·</text>
          <view class="rating-summary" wx:if="{{ratingStats}}">
            <text class="summary-star">â­</text>
            <text class="summary-score">{{ratingStats.average}}</text>
            <text class="summary-count">({{ratingStats.total}}æ¡è¯„ä»·)</text>
          </view>
        </view>
        <view class="header-right">
          <text class="section-more" bindtap="onViewAllReviews">æŸ¥çœ‹å…¨éƒ¨ â€º</text>
          <text class="write-review" bindtap="onWriteReview">å†™è¯„ä»·</text>
        </view>
      </view>

      <!-- è¯„åˆ†åˆ†å¸ƒï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰ -->
      <view class="rating-distribution" wx:if="{{ratingStats && ratingStats.distribution}}">
        <view class="distribution-item" wx:for="{{ratingStats.distribution}}" wx:key="star">
          <text class="star-label">{{item.star}}æ˜Ÿ</text>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.percentage}}%"></view>
          </view>
          <text class="progress-count">{{item.count}}</text>
        </view>
      </view>

      <!-- è¯„ä»·åˆ—è¡¨ -->
      <view class="reviews-list">
        <block wx:for="{{house.reviews}}" wx:key="index" wx:if="{{index < 2}}">
          <view class="review-item">
            <view class="review-header">
              <image class="reviewer-avatar" src="{{item.avatar || 'https://picsum.photos/100/100'}}" mode="aspectFill"></image>
              <view class="reviewer-info">
                <text class="reviewer-name">{{item.name || 'åŒ¿åç”¨æˆ·'}}</text>
                <view class="review-meta">
                  <text class="review-time">{{item.time || 'åˆšåˆš'}}</text>
                  <view class="review-rating">
                    <text class="star">â­</text>
                    <text>{{item.rating || 5}}</text>
                  </view>
                </view>
              </view>
            </view>
            <text class="review-content">{{item.content || 'æš‚æ— è¯„ä»·å†…å®¹'}}</text>
            
            <!-- è¯„ä»·å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰ -->
            <view class="review-images" wx:if="{{item.images && item.images.length > 0}}">
              <image 
                class="review-image" 
                wx:for="{{item.images}}" 
                wx:key="index" 
                src="{{item}}" 
                mode="aspectFill"
                bindtap="onReviewImageTap"
                data-images="{{item.images}}"
                data-index="{{index}}"
              ></image>
            </view>
            
            <!-- æˆ¿ä¸œå›å¤ï¼ˆå¦‚æœæœ‰ï¼‰ -->
            <view class="host-reply" wx:if="{{item.reply}}">
              <text class="reply-label">æˆ¿ä¸œå›å¤ï¼š</text>
              <text class="reply-text">{{item.reply}}</text>
              <text class="reply-time">{{item.replyTime}}</text>
            </view>
            
            <!-- è¯„ä»·äº’åŠ¨ -->
            <view class="review-actions">
              <view class="action-item" bindtap="onLikeReview" data-id="{{item.id}}">
                <text class="action-icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
                <text class="action-count">{{item.likeCount || 0}}</text>
              </view>
              <view class="action-item" bindtap="onReplyReview" data-id="{{item.id}}">
                <text class="action-icon">ğŸ’¬</text>
                <text class="action-count">å›å¤</text>
              </view>
            </view>
          </view>
        </block>
        
        <!-- å¦‚æœæ²¡æœ‰è¯„ä»· -->
        <view class="no-reviews" wx:if="{{!house.reviews || house.reviews.length === 0}}">
          <text class="no-reviews-icon">ğŸ“</text>
          <text class="no-reviews-text">æš‚æ— è¯„ä»·</text>
          <text class="no-reviews-subtext">æˆä¸ºç¬¬ä¸€ä¸ªè¯„ä»·çš„äººå§</text>
        </view>
      </view>
    </view>
    
    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <view class="price-info">
        <text class="total-price">Â¥{{house.price || 0}}</text>
        <text class="unit">/æ™š</text>
        <text class="total-desc" wx:if="{{house.price && house.price * 3}}">Â¥{{house.price * 3}}/3æ™š</text>
      </view>
      <view class="action-buttons">
        <view class="icon-btn" bindtap="onCustomerService">
          <text class="btn-icon">ğŸ’¬</text>
          <text class="btn-text">å®¢æœ</text>
        </view>
        <button class="book-btn" bindtap="onBook">ç«‹å³é¢„è®¢</button>
      </view>
    </view>
  </view>
</view></view>