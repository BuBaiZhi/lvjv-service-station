<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢ç”¨æˆ·"
        bindinput="onSearch"
        value="{{keyword}}"
      ></input>
    </view>
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">å…¨éƒ¨</view>
      <view class="filter-tab {{currentFilter === 'villager' ? 'active' : ''}}" bindtap="setFilter" data-filter="villager">æ‘æ°‘</view>
      <view class="filter-tab {{currentFilter === 'nomad' ? 'active' : ''}}" bindtap="setFilter" data-filter="nomad">æ•°å­—æ¸¸æ°‘</view>
      <view class="filter-tab {{currentFilter === 'admin' ? 'active' : ''}}" bindtap="setFilter" data-filter="admin">ç®¡ç†è€…</view>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <scroll-view class="user-list" scroll-y enhanced show-scrollbar="{{false}}" refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh">
    <!-- ä¿®å¤äº†è¿™ä¸€è¡Œï¼šæŠŠ {{item._id}}="{{item.id}}" æ”¹æˆ data-id="{{item.id}}" -->
    <view class="user-item" wx:for="{{users}}" wx:key="id" bindtap="goToUserDetail" data-id="{{item.id}}">
      <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
      <view class="user-info">
        <view class="user-header">
          <view class="user-name-line">
            <text class="user-name">{{item.name}}</text>
            <text class="user-role {{item.role === 'æ•°å­—æ¸¸æ°‘' ? 'nomad' : item.role === 'ç®¡ç†è€…' ? 'admin' : 'villager'}}">{{item.role}}</text>
          </view>
          <text class="user-status {{item.status === 'æ­£å¸¸' ? 'active' : 'disabled'}}">{{item.status}}</text>
        </view>
        <text class="user-meta">ID: {{item.id}} Â· æ³¨å†Œäº {{item.registerTime}}</text>
        <text class="user-stats">å¸–å­ {{item.postCount}} Â· æˆ¿æº {{item.houseCount}} Â· ç²‰ä¸ {{item.fansCount}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- æ“ä½œå¼¹çª— -->
  <view class="action-modal" wx:if="{{showActionModal}}">
    <view class="modal-mask" bindtap="closeActionModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç”¨æˆ·æ“ä½œ</text>
        <text class="close-btn" bindtap="closeActionModal">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="action-list">
          <view class="action-list-item" bindtap="changeRole">
            <text class="action-icon">ğŸ”„</text>
            <text class="action-text">ä¿®æ”¹è§’è‰²</text>
          </view>
          <view class="action-list-item" bindtap="toggleStatus">
            <text class="action-icon">{{currentUser.status === 'æ­£å¸¸' ? 'ğŸ”’' : 'ğŸ”“'}}</text>
            <text class="action-text">{{currentUser.status === 'æ­£å¸¸' ? 'ç¦ç”¨è´¦å·' : 'å¯ç”¨è´¦å·'}}</text>
          </view>
          <view class="action-list-item delete" bindtap="deleteUser">
            <text class="action-icon">ğŸ—‘ï¸</text>
            <text class="action-text">åˆ é™¤ç”¨æˆ·</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>