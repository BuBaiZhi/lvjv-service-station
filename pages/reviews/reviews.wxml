<view class="container">
  <!-- å¤´éƒ¨ç»Ÿè®¡ -->
  <view class="header">
    <view class="rating-summary">
      <view class="rating-left">
        <text class="rating-score">{{ratingSummary.average}}</text>
        <view class="rating-stars">
          <block wx:for="{{5}}" wx:key="index">
            <text class="star">{{index < ratingSummary.average ? 'â­' : 'â˜†'}}</text>
          </block>
        </view>
        <text class="rating-total">{{ratingSummary.total}}æ¡è¯„ä»·</text>
      </view>
      <view class="rating-right">
        <view class="rating-item" wx:for="{{ratingSummary.distribution}}" wx:key="index">
          <text class="rating-label">{{item.star}}æ˜Ÿ</text>
          <view class="rating-bar">
            <view class="rating-fill" style="width: {{item.percentage}}%"></view>
          </view>
          <text class="rating-count">{{item.count}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <scroll-view class="filter-tabs" scroll-x show-scrollbar="{{false}}">
    <view class="tab-list">
      <view class="tab-item {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">å…¨éƒ¨({{ratingSummary.total}})</view>
      <view class="tab-item {{currentFilter === '5' ? 'active' : ''}}" bindtap="setFilter" data-filter="5">5æ˜Ÿ({{ratingSummary.starCounts[5]}})</view>
      <view class="tab-item {{currentFilter === '4' ? 'active' : ''}}" bindtap="setFilter" data-filter="4">4æ˜Ÿ({{ratingSummary.starCounts[4]}})</view>
      <view class="tab-item {{currentFilter === '3' ? 'active' : ''}}" bindtap="setFilter" data-filter="3">3æ˜Ÿ({{ratingSummary.starCounts[3]}})</view>
      <view class="tab-item {{currentFilter === '2' ? 'active' : ''}}" bindtap="setFilter" data-filter="2">2æ˜Ÿ({{ratingSummary.starCounts[2]}})</view>
      <view class="tab-item {{currentFilter === '1' ? 'active' : ''}}" bindtap="setFilter" data-filter="1">1æ˜Ÿ({{ratingSummary.starCounts[1]}})</view>
      <view class="tab-item {{currentFilter === 'image' ? 'active' : ''}}" bindtap="setFilter" data-filter="image">æœ‰å›¾({{ratingSummary.imageCount}})</view>
    </view>
  </scroll-view>

  <!-- è¯„ä»·åˆ—è¡¨ -->
  <scroll-view 
    class="reviews-list" 
    scroll-y 
    enhanced
    show-scrollbar="{{false}}"
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <view class="review-item" wx:for="{{reviews}}" wx:key="id">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="user-info">
        <image class="user-avatar" src="{{item.user.avatar}}" mode="aspectFill" bindtap="onUserTap" data-user-id="{{item.user.id}}"></image>
        <view class="user-detail">
          <view class="user-name-line">
            <text class="user-name">{{item.user.name}}</text>
            <identity-badge wx:if="{{item.user.identity}}" identity="{{item.user.identity}}"></identity-badge>
          </view>
          <view class="review-meta">
            <view class="stars">
              <block wx:for="{{5}}" wx:key="index">
                <text class="star">â­</text>
              </block>
            </view>
            <text class="review-time">{{item.time}}</text>
          </view>
        </view>
      </view>

      <!-- è¯„ä»·å†…å®¹ -->
      <view class="review-content">
        <text class="review-text">{{item.content}}</text>
      </view>

      <!-- è¯„ä»·å›¾ç‰‡ -->
      <view class="review-images" wx:if="{{item.images && item.images.length > 0}}">
        <image 
          class="review-image" 
          wx:for="{{item.images}}" 
          wx:key="index" 
          src="{{item}}" 
          mode="aspectFill"
          bindtap="onImageTap"
          data-index="{{index}}"
          data-images="{{item.images}}"
        ></image>
      </view>

      <!-- æˆ¿ä¸œå›å¤ -->
      <view class="host-reply" wx:if="{{item.reply}}">
        <text class="reply-label">æˆ¿ä¸œå›å¤ï¼š</text>
        <text class="reply-text">{{item.reply}}</text>
        <text class="reply-time">{{item.replyTime}}</text>
      </view>

      <!-- äº’åŠ¨æ  -->
      <view class="interaction-bar">
        <view class="interaction-item" bindtap="onLike" data-id="{{item._id}}">
          <text class="interaction-icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="interaction-count">{{item.likeCount || ''}}</text>
        </view>
        <view class="interaction-item" bindtap="onReply" data-id="{{item._id}}">
          <text class="interaction-icon">ğŸ’¬</text>
          <text class="interaction-count">{{item.replyCount || ''}}</text>
        </view>
        <view class="interaction-item" bindtap="onShare">
          <text class="interaction-icon">â†—ï¸</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view class="no-more" wx:elif="{{reviews.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{reviews.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— è¯„ä»·</text>
      <text class="empty-subtext">æˆä¸ºç¬¬ä¸€ä¸ªè¯„ä»·çš„äººå§</text>
    </view>
  </scroll-view>

  <!-- å†™è¯„ä»·æŒ‰é’® -->
  <view class="write-review-btn" bindtap="onWriteReview">
    <text class="btn-icon">âœï¸</text>
    <text class="btn-text">å†™è¯„ä»·</text>
  </view>
</view>