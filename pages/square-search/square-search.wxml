<view class="container">
  <!-- æœç´¢æ¡† -->
  <view class="search-header">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å¸–å­ã€æ´»åŠ¨ã€æ‰¾æ­å­..."
        bindinput="onInput"
        value="{{keyword}}"
        confirm-type="search"
        bindconfirm="onSearch"
        auto-focus
      ></input>
      <text class="clear-btn" wx:if="{{keyword}}" bindtap="clearInput">âœ•</text>
    </view>
    <text class="cancel-btn" bindtap="onCancel">å–æ¶ˆ</text>
  </view>

  <!-- æœç´¢ç­›é€‰æ  -->
  <scroll-view class="filter-bar" scroll-x show-scrollbar="{{false}}" wx:if="{{keyword}}">
    <view class="filter-list">
      <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">å…¨éƒ¨</view>
      <view class="filter-item {{currentFilter === 'post' ? 'active' : ''}}" bindtap="setFilter" data-filter="post">å¸–å­</view>
      <view class="filter-item {{currentFilter === 'activity' ? 'active' : ''}}" bindtap="setFilter" data-filter="activity">æ´»åŠ¨</view>
      <view class="filter-item {{currentFilter === 'partner' ? 'active' : ''}}" bindtap="setFilter" data-filter="partner">æ‰¾æ­å­</view>
      <view class="filter-item {{currentFilter === 'skill' ? 'active' : ''}}" bindtap="setFilter" data-filter="skill">æŠ€èƒ½</view>
      <view class="filter-item {{currentFilter === 'user' ? 'active' : ''}}" bindtap="setFilter" data-filter="user">ç”¨æˆ·</view>
    </view>
  </scroll-view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{keyword}}">
    <!-- å¸–å­ç»“æœ -->
    <view class="result-section" wx:if="{{postResults.length > 0 && (currentFilter === 'all' || currentFilter === 'post')}}">
      <view class="section-header">
        <text class="section-title">å¸–å­</text>
        <text class="section-count">{{postResults.length}}ä¸ªç»“æœ</text>
      </view>
      <view class="post-item" wx:for="{{postResults}}" wx:key="id" bindtap="onPostTap" data-id="{{item._id}}">
        <view class="post-header">
          <image class="post-avatar" src="{{item.author.avatar}}" mode="aspectFill"></image>
          <view class="post-info">
            <text class="post-name">{{item.author.name}}</text>
            <text class="post-time">{{formatTime(item.createTime)}}</text>
          </view>
        </view>
        <text class="post-title" wx:if="{{item.title}}">{{item.title}}</text>
        <text class="post-content">{{item.content}}</text>
        <view class="post-stats">
          <text>â¤ï¸ {{item.likes}}</text>
          <text>ğŸ’¬ {{item.comments}}</text>
          <text>ğŸ‘ï¸ {{item.views || 0}}</text>
        </view>
        <view class="post-tags" wx:if="{{item.tags}}">
          <text class="tag" wx:for="{{item.tags}}" wx:key="*this">#{{item}}</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨ç»“æœ -->
    <view class="result-section" wx:if="{{activityResults.length > 0 && (currentFilter === 'all' || currentFilter === 'activity')}}">
      <view class="section-header">
        <text class="section-title">æ´»åŠ¨</text>
        <text class="section-count">{{activityResults.length}}ä¸ªç»“æœ</text>
      </view>
      <view class="activity-item" wx:for="{{activityResults}}" wx:key="id" bindtap="onPostTap" data-id="{{item._id}}">
        <text class="activity-title">{{item.title}}</text>
        <text class="activity-time">{{formatTime(item.createTime)}}</text>
        <text class="activity-location" wx:if="{{item.location}}">{{item.location}}</text>
      </view>
    </view>

    <!-- æ‰¾æ­å­ç»“æœ -->
    <view class="result-section" wx:if="{{partnerResults.length > 0 && (currentFilter === 'all' || currentFilter === 'partner')}}">
      <view class="section-header">
        <text class="section-title">æ‰¾æ­å­</text>
        <text class="section-count">{{partnerResults.length}}ä¸ªç»“æœ</text>
      </view>
      <view class="partner-item" wx:for="{{partnerResults}}" wx:key="id" bindtap="onPostTap" data-id="{{item._id}}">
        <text class="partner-title">{{item.title}}</text>
        <text class="partner-content">{{item.content}}</text>
        <text class="partner-tags" wx:if="{{item.tags}}">{{item.tags.join(' Â· ')}}</text>
      </view>
    </view>

    <!-- æŠ€èƒ½ç»“æœ -->
    <view class="result-section" wx:if="{{skillResults.length > 0 && (currentFilter === 'all' || currentFilter === 'skill')}}">
      <view class="section-header">
        <text class="section-title">æŠ€èƒ½</text>
        <text class="section-count">{{skillResults.length}}ä¸ªç»“æœ</text>
      </view>
      <view class="skill-item" wx:for="{{skillResults}}" wx:key="id" bindtap="onPostTap" data-id="{{item._id}}">
        <text class="skill-title">{{item.title}}</text>
        <text class="skill-price" wx:if="{{item.price}}">Â¥{{item.price}}</text>
      </view>
    </view>

    <!-- ç”¨æˆ·ç»“æœ -->
    <view class="result-section" wx:if="{{userResults.length > 0 && (currentFilter === 'all' || currentFilter === 'user')}}">
      <view class="section-header">
        <text class="section-title">ç”¨æˆ·</text>
        <text class="section-count">{{userResults.length}}ä¸ªç»“æœ</text>
      </view>
      <view class="user-item" wx:for="{{userResults}}" wx:key="id" bindtap="onUserTap" data-id="{{item.id}}">
        <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="user-name">{{item.name}}</text>
          <text class="user-identity">{{item.identity}}</text>
        </view>
      </view>
    </view>

    <!-- æ— ç»“æœ -->
    <view class="no-result" wx:if="{
      postResults.length === 0 && 
      activityResults.length === 0 && 
      partnerResults.length === 0 && 
      skillResults.length === 0 && 
      userResults.length === 0
    }">
      <text class="no-result-icon">ğŸ”</text>
      <text class="no-result-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</text>
      <text class="no-result-subtext">è¯•è¯•å…¶ä»–å…³é”®è¯å§</text>
    </view>
  </view>

  <!-- æœç´¢å†å² -->
  <view class="search-history" wx:else>
    <view class="history-header">
      <text class="history-title">æœç´¢å†å²</text>
      <text class="clear-history" bindtap="clearHistory">æ¸…ç©º</text>
    </view>
    <view class="history-list">
      <text class="history-item" wx:for="{{history}}" wx:key="index" bindtap="onHistoryTap" data-keyword="{{item}}">{{item}}</text>
    </view>
    
    <!-- çƒ­é—¨æœç´¢ -->
    <view class="hot-section">
      <text class="hot-title">çƒ­é—¨æœç´¢</text>
      <view class="hot-list">
        <text class="hot-item" wx:for="{{hotKeywords}}" wx:key="index" bindtap="onHotTap" data-keyword="{{item}}">{{item}}</text>
      </view>
    </view>
  </view>
</view>