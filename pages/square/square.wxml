<view class="container" data-theme="{{theme}}" data-elder="{{elderMode}}" style="background: var(--color-background); min-height: 100vh;">
<view class="container" style="background: #F9FBF8;">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-title">é‚»é‡Œå¹¿åœº</view>
    <view style="display: flex; align-items: center; gap: 30rpx;">
      <text bindtap="onSearch" style="font-size: 40rpx;">ğŸ”</text>
      <text bindtap="onPublish" style="font-size: 40rpx;">âœï¸</text>
    </view>
  </view>

  <!-- åˆ†ç±»Tab -->
  <scroll-view scroll-x show-scrollbar="{{false}}" style="white-space: nowrap; padding: 20rpx 30rpx; background: white;">
    <view style="display: inline-block;">
      <view wx:for="{{categories}}" wx:key="index" 
        style="display: inline-block; padding: 12rpx 32rpx; margin-right: 20rpx; font-size: 28rpx; border-radius: 40rpx; background: {{currentTab === item.id ? 'var(--color-primary)' : 'rgba(168,213,186,0.2)'}}; color: {{currentTab === item.id ? 'white' : 'var(--color-text)'}}; font-weight: {{currentTab === item.id ? '500' : 'normal'}};"
        bindtap="switchTab" data-tab="{{item.id}}">
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- ç­›é€‰æ  -->
  <view style="display: flex; padding: 20rpx 30rpx; background: white; border-top: 2rpx solid rgba(74,122,92,0.05);">
    <view class="tag" bindtap="showRegionPicker" style="margin-right: 20rpx; background: white; border: 2rpx solid var(--color-secondary);">
      <text>{{currentRegion || 'å…¨éƒ¨åœ°åŒº'}}</text>
      <text style="margin-left: 8rpx;">â–¼</text>
    </view>
    <view class="tag" bindtap="showMoreFilter" style="background: white; border: 2rpx solid var(--color-secondary);">
      <text>ç­›é€‰</text>
      <text style="margin-left: 8rpx;">âš™ï¸</text>
    </view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <scroll-view scroll-y style="height: calc(100vh - 280rpx); padding: 20rpx 30rpx;" refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh" bindscrolltolower="onLoadMore">
    <view wx:for="{{posts}}" wx:key="id" class="card fade-in" style="margin-bottom: 20rpx;">
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view bindtap="onAuthorTap" data-author-id="{{item.author.id}}" style="display: flex; align-items: center; margin-bottom: 20rpx;">
        <image src="{{item.author.avatar}}" style="width: 72rpx; height: 72rpx; border-radius: 50%; margin-right: 16rpx; border: 2rpx solid var(--color-secondary);"></image>
        <view style="flex: 1;">
          <view style="display: flex; align-items: center;">
            <text style="font-size: 28rpx; font-weight: 600; color: var(--color-primary); margin-right: 8rpx;">{{item.author.name}}</text>
            <identity-badge identity="{{item.author.identity}}"></identity-badge>
          </view>
          <text style="font-size: 22rpx; color: var(--color-text-light);">{{item.time}} Â· {{item.location || 'æœªçŸ¥'}}</text>
        </view>
      </view>

      <!-- å¸–å­ç±»å‹ -->
      <text class="tag" wx:if="{{item.type}}" style="margin-bottom: 16rpx; display: inline-block;"># {{item.type}}</text>

      <!-- æ ‡é¢˜ -->
      <text wx:if="{{item.title}}" style="font-size: 32rpx; font-weight: 600; color: var(--color-text); margin-bottom: 12rpx; display: block;">{{item.title}}</text>

      <!-- å†…å®¹ -->
      <text style="font-size: 28rpx; color: var(--color-text-light); line-height: 1.5; margin-bottom: 20rpx; display: block;">{{item.content}}</text>

      <!-- å›¾ç‰‡ -->
      <view wx:if="{{item.images && item.images.length > 0}}" style="display: flex; gap: 8rpx; margin-bottom: 20rpx;">
        <image wx:for="{{item.images}}" wx:key="index" wx:if="{{index < 3}}" src="{{item}}" style="width: 200rpx; height: 200rpx; border-radius: 20rpx;" mode="aspectFill"></image>
      </view>

      <!-- æ ‡ç­¾ -->
      <view wx:if="{{item.tags && item.tags.length > 0}}" style="display: flex; gap: 12rpx; margin-bottom: 20rpx;">
        <text class="tag" wx:for="{{item.tags}}" wx:key="index">#{{item}}</text>
      </view>

      <!-- äº’åŠ¨æ  -->
      <view style="display: flex; align-items: center; justify-content: space-around; padding-top: 20rpx; border-top: 2rpx solid rgba(74,122,92,0.1);">
        <view bindtap="onPostLike" data-post-id="{{item._id}}" data-is-liked="{{item.isLiked}}" data-likes="{{item.likes}}" style="display: flex; align-items: center; gap: 8rpx;">
          <text style="font-size: 36rpx;">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text style="font-size: 24rpx; color: var(--color-text-light);">{{item.likes}}</text>
        </view>
        <view bindtap="onPostComment" data-post-id="{{item._id}}" style="display: flex; align-items: center; gap: 8rpx;">
          <text style="font-size: 36rpx;">ğŸ’¬</text>
          <text style="font-size: 24rpx; color: var(--color-text-light);">{{item.comments}}</text>
        </view>
        <view bindtap="onPostCollect" data-post-id="{{item._id}}" data-is-collected="{{item.isCollected}}" style="display: flex; align-items: center; gap: 8rpx;">
          <text style="font-size: 36rpx;">{{item.isCollected ? 'â­' : 'â˜†'}}</text>
        </view>
        <view bindtap="onShare" style="display: flex; align-items: center; gap: 8rpx;">
          <text style="font-size: 36rpx;">â†—ï¸</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view style="text-align: center; padding: 40rpx 0;">
      <text wx:if="{{hasMore}}" style="color: var(--color-text-light);">åŠ è½½ä¸­...</text>
      <text wx:else style="color: var(--color-text-light);">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>
</view>
</view>