<view class="container {{theme === 'dark' ? 'dark' : ''}} {{elderMode ? 'elder-mode' : ''}}" data-theme="{{theme}}" data-elder="{{elderMode ? 'true' : 'false'}}">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-title">é‚»é‡Œå¹¿åœº</view>
    <view class="nav-actions">
      <view class="nav-icon-btn" bindtap="onSearch">
        <image class="nav-icon-img" src="/images/icons/search.png" mode="aspectFit"></image>
      </view>
      <view class="nav-icon-btn" bindtap="onPublish">
        <image class="nav-icon-img" src="/images/icons/å¢åŠ æ·»åŠ åŠ å·.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»Tab -->
  <scroll-view scroll-x show-scrollbar="{{false}}" class="tab-scroll">
    <view class="tab-list">
      <view wx:for="{{categories}}" wx:key="index" 
        class="tab-item {{currentTab === item.id ? 'active' : ''}}"
        bindtap="switchTab" data-tab="{{item.id}}">
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-tag" bindtap="showRegionPicker">
      <text>{{currentRegion || 'å…¨éƒ¨åœ°åŒº'}}</text>
      <text class="filter-arrow">â–¼</text>
    </view>
    <view class="filter-tag" bindtap="showMoreFilter">
      <text>ç­›é€‰</text>
      <text class="filter-icon">âš™ï¸</text>
    </view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <scroll-view scroll-y class="post-scroll" refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh" bindscrolltolower="onLoadMore">
    <view wx:for="{{posts}}" wx:key="id" class="card post-card fade-in" bindtap="onPostTap" data-id="{{item._id}}">
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view class="post-author" catchtap="onAuthorTap" data-author-id="{{item.author.id}}">
        <image src="{{item.author.avatar}}" class="author-avatar"></image>
        <view class="author-info">
          <view class="author-name-row">
            <text class="author-name">{{item.author.name}}</text>
            <identity-badge identity="{{item.author.identity}}"></identity-badge>
          </view>
          <text class="post-meta">{{item.time}} Â· {{item.location || 'æœªçŸ¥'}}</text>
        </view>
      </view>

      <!-- å¸–å­ç±»å‹ -->
      <text class="tag" wx:if="{{item.type}}"># {{item.type}}</text>

      <!-- æ ‡é¢˜ -->
      <text wx:if="{{item.title}}" class="post-title">{{item.title}}</text>

      <!-- å†…å®¹ -->
      <text class="post-content">{{item.content}}</text>

      <!-- å›¾ç‰‡ -->
      <view wx:if="{{item.images && item.images.length > 0}}" class="post-images">
        <image wx:for="{{item.images}}" wx:key="index" wx:if="{{index < 3}}" src="{{item}}" class="post-image" mode="aspectFill"></image>
      </view>

      <!-- æ ‡ç­¾ -->
      <view wx:if="{{item.tags && item.tags.length > 0}}" class="post-tags">
        <text class="tag" wx:for="{{item.tags}}" wx:key="index">#{{item}}</text>
      </view>

      <!-- äº’åŠ¨æ  -->
      <view class="post-actions">
        <view class="action-item" catchtap="onPostLike" data-post-id="{{item._id}}" data-is-liked="{{item.isLiked}}" data-likes="{{item.likes}}">
          <text class="action-icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-count">{{item.likes}}</text>
        </view>
        <view class="action-item" catchtap="onPostComment" data-post-id="{{item._id}}">
          <text class="action-icon">ğŸ’¬</text>
          <text class="action-count">{{item.comments}}</text>
        </view>
        <view class="action-item" catchtap="onPostCollect" data-post-id="{{item._id}}" data-is-collected="{{item.isCollected}}">
          <text class="action-icon">{{item.isCollected ? 'â­' : 'â˜†'}}</text>
        </view>
        <view class="action-item" catchtap="onShare">
          <text class="action-icon">â†—ï¸</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-status">
      <text wx:if="{{hasMore}}">åŠ è½½ä¸­...</text>
      <text wx:else>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>

  <!-- åœ°åŒºé€‰æ‹©å¼¹çª— -->
  <view class="filter-modal" wx:if="{{showRegionModal}}">
    <view class="modal-mask" bindtap="hideRegionPicker"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©åœ°åŒº</text>
        <text class="close-btn" bindtap="hideRegionPicker">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="region-list">
          <view class="region-item {{currentRegion === item ? 'active' : ''}}" wx:for="{{regions}}" wx:key="index" bindtap="selectRegion" data-region="{{item}}">
            <text class="region-name">{{item}}</text>
            <text class="region-check" wx:if="{{currentRegion === item}}">âœ“</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ›´å¤šç­›é€‰å¼¹çª— -->
  <view class="filter-modal" wx:if="{{showMoreFilterModal}}">
    <view class="modal-mask" bindtap="hideMoreFilter"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç­›é€‰</text>
        <text class="close-btn" bindtap="hideMoreFilter">âœ•</text>
      </view>
      <view class="modal-body">
        <!-- å¸–å­ç±»å‹ -->
        <view class="filter-section">
          <text class="section-title">å¸–å­ç±»å‹</text>
          <view class="filter-options">
            <view class="option-item {{filterType === 'all' ? 'active' : ''}}" bindtap="setFilterType" data-type="all">å…¨éƒ¨</view>
            <view class="option-item {{filterType === 'æ´»åŠ¨' ? 'active' : ''}}" bindtap="setFilterType" data-type="æ´»åŠ¨">æ´»åŠ¨ä¿¡æ¯</view>
            <view class="option-item {{filterType === 'æ‰¾æ­å­' ? 'active' : ''}}" bindtap="setFilterType" data-type="æ‰¾æ­å­">æ‰¾æ­å­</view>
            <view class="option-item {{filterType === 'æŠ€èƒ½å˜ç°' ? 'active' : ''}}" bindtap="setFilterType" data-type="æŠ€èƒ½å˜ç°">æŠ€èƒ½å˜ç°</view>
            <view class="option-item {{filterType === 'è®¨è®º' ? 'active' : ''}}" bindtap="setFilterType" data-type="è®¨è®º">ç¤¾åŒºè®¨è®º</view>
          </view>
        </view>
        <!-- å‘å¸ƒæ—¶é—´ -->
        <view class="filter-section">
          <text class="section-title">å‘å¸ƒæ—¶é—´</text>
          <view class="filter-options">
            <view class="option-item {{filterTime === 'all' ? 'active' : ''}}" bindtap="setFilterTime" data-time="all">å…¨éƒ¨</view>
            <view class="option-item {{filterTime === 'today' ? 'active' : ''}}" bindtap="setFilterTime" data-time="today">ä»Šå¤©</view>
            <view class="option-item {{filterTime === 'week' ? 'active' : ''}}" bindtap="setFilterTime" data-time="week">æœ¬å‘¨</view>
            <view class="option-item {{filterTime === 'month' ? 'active' : ''}}" bindtap="setFilterTime" data-time="month">æœ¬æœˆ</view>
          </view>
        </view>
        <!-- å›¾ç‰‡ç­›é€‰ -->
        <view class="filter-section">
          <text class="section-title">å›¾ç‰‡</text>
          <view class="filter-options">
            <view class="option-item {{filterImage === 'all' ? 'active' : ''}}" bindtap="setFilterImage" data-image="all">å…¨éƒ¨</view>
            <view class="option-item {{filterImage === 'has' ? 'active' : ''}}" bindtap="setFilterImage" data-image="has">æœ‰å›¾</view>
            <view class="option-item {{filterImage === 'no' ? 'active' : ''}}" bindtap="setFilterImage" data-image="no">æ— å›¾</view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="reset-btn" bindtap="resetFilter">é‡ç½®</button>
        <button class="confirm-btn" bindtap="applyFilter">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>