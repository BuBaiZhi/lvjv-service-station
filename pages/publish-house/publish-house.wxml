<view class="container" data-theme="{{theme}}" data-elder="{{elderMode}}" style="background: var(--color-background); min-height: 100vh;">
<view class="container">
  <form catchsubmit="onSubmit">
    <!-- 房源标题 -->
    <view class="form-item">
      <text class="form-label">房源标题 <text class="required">*</text></text>
      <input 
        class="form-input" 
        placeholder="例如：三亚NCC社区·唯吾岛"
        bindinput="onTitleInput"
        value="{{title}}"
      ></input>
    </view>

    <!-- 封面图 -->
    <view class="form-item">
      <text class="form-label">封面图 <text class="required">*</text></text>
      <view class="image-uploader">
        <view class="image-list">
          <view class="image-item" wx:if="{{coverImage}}">
            <image class="uploaded-image" src="{{coverImage}}" mode="aspectFill"></image>
            <text class="remove-image" bindtap="removeCover">✕</text>
          </view>
          <view class="upload-btn" wx:else bindtap="chooseCover">
            <text class="upload-icon">+</text>
            <text class="upload-text">上传封面</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 多图上传 -->
    <view class="form-item">
      <text class="form-label">房源图片</text>
      <view class="image-uploader">
        <view class="image-list">
          <block wx:for="{{images}}" wx:key="index">
            <view class="image-item">
              <image class="uploaded-image" src="{{item}}" mode="aspectFill"></image>
              <text class="remove-image" bindtap="removeImage" data-index="{{index}}">✕</text>
            </view>
          </block>
          <view class="upload-btn" wx:if="{{images.length < 9}}" bindtap="chooseImages">
            <text class="upload-icon">+</text>
            <text class="upload-text">上传图片</text>
          </view>
        </view>
      </view>
    </view>

<!-- 位置 -->
<view class="form-item">
  <text class="form-label">位置 <text class="required">*</text></text>
  
  <!-- 地图选点入口（美团外卖风格） -->
  <view class="map-picker" bindtap="openMapPicker">
    <view class="map-preview" wx:if="{{!location}}">
      <text class="map-icon">🗺️</text>
      <view class="map-texts">
        <text class="map-title">点击选择位置</text>
        <text class="map-subtitle">支持搜索、拖动地图精确选点</text>
      </view>
    </view>
    
    <!-- 已选位置显示 -->
    <view class="selected-location" wx:else>
      <text class="location-icon">📍</text>
      <view class="location-detail">
        <text class="location-name">{{location}}</text>
        <text class="location-coord" wx:if="{{latitude && longitude}}">
          纬度: {{latitude.toFixed(4)}} 经度: {{longitude.toFixed(4)}}
        </text>
      </view>
      <text class="change-location" bindtap="clearLocation" catchtap>更换</text>
    </view>
  </view>
</view>

    <!-- 价格 -->
    <view class="form-item">
      <text class="form-label">价格 <text class="required">*</text></text>
      <view class="price-input">
        <input 
          class="form-input price-field" 
          type="number" 
          placeholder="请输入价格"
          bindinput="onPriceInput"
          value="{{price}}"
        ></input>
        <text class="price-unit">元/天</text>
      </view>
    </view>

    <!-- 设施 -->
    <view class="form-item">
      <text class="form-label">设施</text>
      <view class="facility-list">
        <label class="facility-item" wx:for="{{facilityOptions}}" wx:key="index">
          <checkbox value="{{item}}" checked="{{selectedFacilities.includes(item)}}" bindchange="onFacilityChange" data-facility="{{item}}"></checkbox>
          <text class="facility-name">{{item}}</text>
        </label>
      </view>
    </view>

    <!-- 房源介绍 -->
    <view class="form-item">
      <text class="form-label">房源介绍 <text class="required">*</text></text>
      <textarea 
        class="form-textarea"
        placeholder="详细介绍你的房源..."
        bindinput="onDescInput"
        value="{{description}}"
        maxlength="500"
      ></textarea>
      <text class="word-count">{{description.length}}/500</text>
    </view>

    <!-- 标签 -->
    <view class="form-item">
      <text class="form-label">标签</text>
      <view class="tags-input">
        <input 
          class="tag-input"
          placeholder="输入标签后按空格添加"
          bindinput="onTagInput"
          bindconfirm="addTag"
          value="{{tagInput}}"
        ></input>
        <view class="tag-list">
          <view class="tag-item" wx:for="{{tags}}" wx:key="index">
            <text class="tag-text">#{{item}}</text>
            <text class="remove-tag" bindtap="removeTag" data-index="{{index}}">✕</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 发布按钮 -->
    <button class="publish-btn" form-type="submit" disabled="{{!canPublish}}">发布房源</button>
  </form>
</view>
</view>