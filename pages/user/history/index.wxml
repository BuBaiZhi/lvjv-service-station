<!-- æµè§ˆå†å²é¡µé¢ -->
<view class="page" data-theme="{{theme}}" data-elder="{{elderMode}}">
  <!-- å¯¼èˆªæ  -->
  <view class="page-header">
    <text class="back-btn" bindtap="goBack">â€¹ è¿”å›</text>
  </view>

  <!-- æ ‡ç­¾æ ï¼šæµè§ˆ/ç‚¹èµ/æ”¶è—/è¯„è®º -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'history' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="history">
      æµè§ˆ
    </view>
    <view 
      class="tab-item {{activeTab === 'likes' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="likes">
      ç‚¹èµ
    </view>
    <view 
      class="tab-item {{activeTab === 'collects' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="collects">
      æ”¶è—
    </view>
    <view 
      class="tab-item {{activeTab === 'comments' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="comments">
      è¯„è®º
    </view>
  </view>

  <!-- ç±»å‹ç­›é€‰ -->
  <view class="filter-bar">
    <view class="filter-btn" bindtap="toggleTypeFilter">
      {{ currentTypeFilter === 'all' ? 'å…¨éƒ¨' :
         currentTypeFilter === 'house' ? 'æ°‘å®¿' :
         currentTypeFilter === 'activity' ? 'æ´»åŠ¨' :
         currentTypeFilter === 'skill' ? 'æŠ€èƒ½' :
         'åˆ†äº«' }}
      <text class="arrow {{typeFilterShow ? 'up' : ''}}">â–¼</text>
    </view>
  </view>

  <!-- ä¸‹æ‹‰é®ç½© -->
  <view wx:if="{{typeFilterShow}}" class="mask" bindtap="closeTypeFilter">
    <view class="dropdown" catchtap="noop">
      <view 
        class="dropdown-item {{currentTypeFilter === item.value ? 'active' : ''}}"
        wx:for="{{typeOptions}}"
        wx:key="value"
        data-type="{{item.value}}"
        bindtap="toggleTypeFilter">
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- å†å²åˆ—è¡¨ -->
  <view class="content">
    <view 
      class="history-card"
      wx:for="{{filteredList}}"
      wx:key="id"
      bindtap="viewDetail"
      data-id="{{item.id}}"
    >
      <image class="history-image" src="{{item.image}}" mode="aspectFill"></image>
      
      <view class="history-info">
        <text class="history-title">{{item.title}}</text>
        <text class="history-type">
          {{item.type === 'house' ? 'æ°‘å®¿' : item.type === 'activity' ? 'æ´»åŠ¨' : item.type === 'skill' ? 'æŠ€èƒ½' : 'åˆ†äº«'}}
        </text>
        <!-- è¯„è®ºæ˜¾ç¤ºå†…å®¹ï¼Œå…¶ä»–æ˜¾ç¤ºä»·æ ¼ -->
        <text class="history-content" wx:if="{{activeTab === 'comments' && item.content}}">{{item.content}}</text>
        <view class="history-footer">
          <text class="history-price" wx:if="{{activeTab !== 'comments'}}">Â¥{{item.price}}</text>
          <text class="history-date">{{item.date}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{filteredList.length === 0}}">
      <text class="empty-icon">{{activeTab === 'history' ? 'ğŸ‘ï¸' : activeTab === 'likes' ? 'â¤ï¸' : activeTab === 'collects' ? 'â­' : 'ğŸ’¬'}}</text>
      <text class="empty-text">
        {{activeTab === 'history' ? 'æš‚æ— æµè§ˆè®°å½•' : 
          activeTab === 'likes' ? 'æš‚æ— ç‚¹èµè®°å½•' : 
          activeTab === 'collects' ? 'æš‚æ— æ”¶è—è®°å½•' : 
          'æš‚æ— è¯„è®ºè®°å½•'}}
      </text>
    </view>
  </view>
</view>
