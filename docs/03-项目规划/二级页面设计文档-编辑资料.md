# 编辑资料页面设计文档

## 📋 页面概述

**页面名称**：编辑资料  
**路由**：`/pages/user-center/edit-profile`  
**功能**：编辑用户的个人信息（头像、昵称、性别、身份、简介、背景）  
**优先级**：⭐⭐⭐ 核心功能  

---

## 🎯 功能需求

### 核心功能

1. **头像编辑**
   - 显示当前头像
   - 支持上传新头像
   - 支持裁剪头像
   - 支持预览

2. **基本信息编辑**
   - 昵称编辑
   - 性别选择
   - 身份选择（村民/游民）
   - 个人简介编辑

3. **背景编辑**
   - 选择预设背景
   - 上传自定义背景
   - 实时预览

4. **表单验证**
   - 昵称不能为空
   - 昵称长度限制（2-20 字）
   - 简介长度限制（0-200 字）

5. **保存功能**
   - 保存修改
   - 显示成功提示
   - 返回上一页

---

## 📐 页面布局

### 整体结构

```
┌─────────────────────────────────┐
│ ← 返回    编辑资料              │  ← 页面头部
├─────────────────────────────────┤
│                                 │
│  头像编辑区                     │
│  ┌─────────────────────────────┐│
│  │        [头像]               ││
│  │      [更换头像]             ││
│  └─────────────────────────────┘│
│                                 │
│  基本信息编辑区                 │
│  ┌─────────────────────────────┐│
│  │ 昵称                        ││
│  │ [输入框: 当前昵称]          ││
│  │                             ││
│  │ 性别                        ││
│  │ [男] [女] [其他]            ││
│  │                             ││
│  │ 身份                        ││
│  │ [村民] [游民]               ││
│  │                             ││
│  │ 个人简介                    ││
│  │ [文本框: 当前简介...]       ││
│  │ 0/200                       ││
│  └─────────────────────────────┘│
│                                 │
│  背景编辑区                     │
│  ┌─────────────────────────────┐│
│  │ 卡片背景                    ││
│  │ [当前背景预览]              ││
│  │ [编辑背景]                  ││
│  └─────────────────────────────┘│
│                                 │
│  [取消]              [保存]     │
│                                 │
└─────────────────────────────────┘
```

### 页面头部

**高度**：56px  
**背景**：白色 `#FFFFFF`  
**阴影**：中阴影  

**组件**：
- 返回按钮（左侧）：`←`
- 页面标题（中间）：`编辑资料`
- 空白（右侧）

### 头像编辑区

**布局**：垂直居中

```
┌─────────────────────────────────┐
│                                 │
│        [头像]                   │
│      (120x120)                  │
│                                 │
│      [更换头像]                 │
│                                 │
└─────────────────────────────────┘
```

**尺寸**：
- 头像大小：120x120px
- 圆角：9999px（圆形）
- 边框：3px 白色
- 按钮高度：40px

**样式**：
- 背景：浅灰色 `#F5F5F5`
- 内边距：24px
- 圆角：12px

### 基本信息编辑区

**布局**：表单式

```
┌─────────────────────────────────┐
│ 昵称                            │
│ [输入框: 当前昵称]              │
│                                 │
│ 性别                            │
│ [男] [女] [其他]                │
│                                 │
│ 身份                            │
│ [村民] [游民]                   │
│                                 │
│ 个人简介                        │
│ [文本框: 当前简介...]           │
│ 0/200                           │
└─────────────────────────────────┘
```

**尺寸**：
- 标签高度：20px
- 输入框高度：40px
- 文本框高度：100px
- 间距：16px

**样式**：
- 背景：白色 `#FFFFFF`
- 内边距：16px
- 圆角：8px
- 边框：1px 浅灰色

### 背景编辑区

**布局**：卡片式

```
┌─────────────────────────────────┐
│ 卡片背景                        │
│ [当前背景预览]                  │
│ (宽度 100%, 高度 120px)         │
│ [编辑背景]                      │
└─────────────────────────────────┘
```

**尺寸**：
- 预览高度：120px
- 按钮高度：40px
- 圆角：12px

**样式**：
- 背景：当前背景
- 内边距：16px
- 圆角：12px
- 阴影：中阴影

### 页面底部

**高度**：60px（含内边距）  
**背景**：白色 `#FFFFFF`  
**阴影**：深阴影  
**固定**：底部  

**按钮**：
- 取消按钮（左侧）：浅灰色
- 保存按钮（右侧）：绿色

---

## 🔄 交互流程

### 页面加载

```
页面打开
    ↓
加载用户信息
    ↓
填充表单数据
    ↓
显示当前背景预览
    ↓
页面就绪
```

### 头像上传

```
点击"更换头像"按钮
    ↓
打开文件选择器
    ↓
用户选择图片
    ↓
显示图片预览
    ↓
用户确认
    ↓
更新头像显示
```

### 性别选择

```
点击性别选项
    ↓
切换选中状态
    ↓
更新表单数据
```

### 身份选择

```
点击身份选项
    ↓
切换选中状态
    ↓
更新表单数据
```

### 简介编辑

```
点击简介输入框
    ↓
输入文字
    ↓
实时显示字数
    ↓
超过限制时禁止输入
```

### 背景编辑

```
点击"编辑背景"按钮
    ↓
打开背景选择器
    ↓
用户选择背景
    ↓
确认选择
    ↓
更新背景预览
```

### 保存修改

```
点击"保存"按钮
    ↓
验证表单数据
    ↓
显示加载动画
    ↓
提交修改
    ↓
显示成功提示
    ↓
返回上一页
```

### 取消修改

```
点击"取消"按钮
    ↓
返回上一页
```

---

## 📊 数据结构

### 用户信息对象

```typescript
interface UserProfile {
  id: string                    // 用户 ID
  avatar: string                // 头像 URL
  nickname: string              // 昵称
  gender: 'male' | 'female' | 'other' | null  // 性别
  identity: 'villager' | 'nomad'  // 身份
  bio: string                   // 个人简介
  background: {                 // 背景信息
    type: 'default' | 'custom'
    backgroundId?: string
    imageUrl?: string
  }
}
```

### 表单数据

```typescript
interface ProfileForm {
  avatar: string                // 头像 URL
  nickname: string              // 昵称
  gender: 'male' | 'female' | 'other' | null
  identity: 'villager' | 'nomad'
  bio: string                   // 个人简介
}
```

### Mock 数据示例

```typescript
const mockUserProfile = {
  id: '123',
  avatar: 'https://example.com/avatar.jpg',
  nickname: '张三',
  gender: 'male',
  identity: 'villager',
  bio: '热爱乡村生活，喜欢分享农村经验',
  background: {
    type: 'default',
    backgroundId: 'green'
  }
}
```

---

## 🎨 样式规范

### 颜色

| 元素 | 颜色 | 用途 |
|------|------|------|
| 背景 | `#F5F5F5` | 页面背景 |
| 卡片 | `#FFFFFF` | 编辑区卡片 |
| 标签 | `#212121` | 表单标签 |
| 输入框 | `#FFFFFF` | 输入框背景 |
| 边框 | `#BDBDBD` | 输入框边框 |
| 文字 | `#212121` | 输入文字 |
| 占位符 | `#BDBDBD` | 占位符文字 |
| 选中 | `#4CAF50` | 选中状态 |
| 未选中 | `#F5F5F5` | 未选中状态 |

### 间距

```
页面内边距：16px
卡片间距：16px
卡片内边距：16px
表单项间距：16px
```

### 圆角

```
输入框：8px
卡片：12px
按钮：8px
头像：9999px（圆形）
```

---

## 🔧 技术实现

### 状态管理

```typescript
// 页面状态
const userProfile = ref<UserProfile>()  // 用户信息
const formData = ref<ProfileForm>({     // 表单数据
  avatar: '',
  nickname: '',
  gender: null,
  identity: 'villager',
  bio: ''
})
const loading = ref(false)              // 加载状态
const saving = ref(false)               // 保存状态
const bioLength = ref(0)                // 简介字数
```

### 计算属性

```typescript
// 是否有修改
const hasChanged = computed(() => {
  return JSON.stringify(formData.value) !== JSON.stringify(userProfile.value)
})

// 简介字数
const bioLength = computed(() => {
  return formData.value.bio.length
})

// 保存按钮是否禁用
const isSaveDisabled = computed(() => {
  return !formData.value.nickname || saving.value
})
```

### 方法

```typescript
// 加载用户信息
const loadUserProfile = async () => {
  loading.value = true
  try {
    // 模拟 API 调用
    await new Promise(resolve => setTimeout(resolve, 500))
    userProfile.value = mockUserProfile
    formData.value = { ...mockUserProfile }
  } finally {
    loading.value = false
  }
}

// 上传头像
const uploadAvatar = () => {
  if (typeof uni === 'undefined') {
    // 浏览器环境
    const input = document.createElement('input')
    input.type = 'file'
    input.accept = 'image/*'
    input.onchange = (e: any) => {
      const file = e.target.files[0]
      const reader = new FileReader()
      reader.onload = (event: any) => {
        formData.value.avatar = event.target.result
      }
      reader.readAsDataURL(file)
    }
    input.click()
  } else {
    // uni-app 环境
    uni.chooseImage({
      count: 1,
      sizeType: ['compressed'],
      sourceType: ['album', 'camera'],
      success: (res) => {
        formData.value.avatar = res.tempFilePaths[0]
      }
    })
  }
}

// 编辑背景
const editBackground = () => {
  // 打开背景选择器
  console.log('打开背景选择器')
}

// 验证表单
const validateForm = (): boolean => {
  if (!formData.value.nickname) {
    alert('昵称不能为空')
    return false
  }
  if (formData.value.nickname.length < 2 || formData.value.nickname.length > 20) {
    alert('昵称长度应为 2-20 字')
    return false
  }
  if (formData.value.bio.length > 200) {
    alert('简介长度不能超过 200 字')
    return false
  }
  return true
}

// 保存修改
const saveProfile = async () => {
  if (!validateForm()) return
  
  saving.value = true
  try {
    // 模拟 API 调用
    await new Promise(resolve => setTimeout(resolve, 1000))
    
    // 显示成功提示
    if (typeof uni === 'undefined') {
      alert('保存成功')
    } else {
      uni.showToast({ title: '保存成功', icon: 'success' })
    }
    
    // 返回上一页
    goBack()
  } finally {
    saving.value = false
  }
}

// 取消修改
const cancel = () => {
  goBack()
}

// 返回
const goBack = () => {
  if (typeof uni === 'undefined') {
    window.history.back()
  } else {
    uni.navigateBack()
  }
}

// 页面加载
onMounted(() => {
  loadUserProfile()
})
```

---

## 📱 响应式设计

### 小屏幕（< 576px）

- 头像大小：100x100px
- 输入框高度：36px
- 文本框高度：80px
- 字体缩小 10%
- 间距缩小 10%

### 中屏幕（576px - 768px）

- 头像大小：120x120px
- 输入框高度：40px
- 文本框高度：100px
- 标准字体
- 标准间距

### 大屏幕（> 768px）

- 头像大小：140x140px
- 输入框高度：44px
- 文本框高度：120px
- 字体放大 10%
- 间距放大 10%

---

## 🧪 测试清单

### 功能测试

- [ ] 页面加载正常
- [ ] 用户信息显示正确
- [ ] 头像上传正常
- [ ] 性别选择正常
- [ ] 身份选择正常
- [ ] 简介编辑正常
- [ ] 字数限制正常
- [ ] 背景编辑正常
- [ ] 表单验证正常
- [ ] 保存修改正常
- [ ] 取消修改正常

### 界面测试

- [ ] 布局美观
- [ ] 文字清晰
- [ ] 颜色搭配
- [ ] 间距合理
- [ ] 输入框清晰
- [ ] 按钮响应

### 交互测试

- [ ] 返回按钮正常
- [ ] 输入框聚焦
- [ ] 选项切换流畅
- [ ] 按钮响应正常
- [ ] 加载动画显示
- [ ] 成功提示显示

### 验证测试

- [ ] 昵称为空验证
- [ ] 昵称长度验证
- [ ] 简介长度验证
- [ ] 错误提示显示

### 兼容性测试

- [ ] 浏览器环境
- [ ] uni-app 环境
- [ ] 微信小程序
- [ ] 不同屏幕尺寸

---

## 📝 开发检查清单

- [ ] 页面结构完整
- [ ] 样式规范统一
- [ ] 表单绑定正确
- [ ] 验证逻辑完善
- [ ] 错误处理完善
- [ ] 加载状态处理
- [ ] 响应式适配
- [ ] 代码注释完整
- [ ] 文档更新完整

---

**文档版本**：1.0.0  
**最后更新**：2026-02-12  
**维护者**：Kiro AI Assistant
