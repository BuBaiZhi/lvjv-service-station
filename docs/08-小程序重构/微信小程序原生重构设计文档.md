# 微信小程序原生重构设计文档

**项目名称**：旅居服务站  
**原框架**：Vue 3 + uni-app  
**目标框架**：微信小程序原生  
**版本**：v1.0  
**日期**：2026-02-18

---

## 一、项目结构对比

### 1.1 原项目结构（Vue/uni-app）

```
旅居服务站/
├── App.vue                 # 应用入口
├── main.js                 # 入口文件
├── pages/
│   ├── index/             # 首页
│   └── user-center/       # 用户中心
│       ├── index.vue
│       ├── edit-profile.vue
│       ├── order-list.vue
│       ├── publish-list.vue
│       ├── history-list.vue
│       ├── service-support.vue
│       └── settings.vue
├── components/             # 组件
├── stores/                 # 状态管理
├── services/               # API服务
├── router/                 # 路由
└── styles/                 # 样式
```

### 1.2 目标项目结构（微信小程序原生）

```
旅居服务站-mini/
├── app.js                  # 应用入口
├── app.json                # 应用配置
├── app.wxss                # 全局样式
├── pages/
│   ├── index/              # 首页
│   │   ├── index.js
│   │   ├── index.json
│   │   ├── index.wxml
│   │   └── index.wxss
│   └── user-center/        # 用户中心
│       ├── index/
│       │   ├── index.js
│       │   ├── index.json
│       │   ├── index.wxml
│       │   └── index.wxss
│       ├── edit-profile/
│       ├── order-list/
│       ├── publish-list/
│       ├── history-list/
│       ├── service-support/
│       └── settings/
├── components/              # 组件
├── utils/                   # 工具函数
├── services/                 # API服务
└── images/                  # 图片资源
```

---

## 二、文件对应关系

### 2.1 入口文件对应

| Vue/uni-app | 微信小程序原生 |
|-------------|----------------|
| App.vue | app.js + app.wxss |
| main.js | app.js |
| router/index.ts | app.json (pages) |
| - | app.json (window) |
| pages.json | app.json |

### 2.2 页面文件对应

| Vue/uni-app | 微信小程序原生 |
|-------------|----------------|
| pages/index/index.vue | pages/index/index.{js,wxml,wxss,json} |
| pages/user-center/index.vue | pages/user-center/index/index.{js,wxml,wxss,json} |
| pages/user-center/edit-profile.vue | pages/user-center/edit-profile/index.{js,wxml,wxss,json} |
| pages/user-center/order-list.vue | pages/user-center/order-list/index.{js,wxml,wxss,json} |
| pages/user-center/publish-list.vue | pages/user-center/publish-list/index.{js,wxml,wxss,json} |
| pages/user-center/history-list.vue | pages/user-center/history-list/index.{js,wxml,wxss,json} |
| pages/user-center/service-support.vue | pages/user-center/service-support/index.{js,wxml,wxss,json} |
| pages/user-center/settings.vue | pages/user-center/settings/index.{js,wxml,wxss,json} |

### 2.2 组件文件对应

| Vue/uni-app | 微信小程序原生 |
|-------------|----------------|
| components/xxx.vue | components/xxx/index.{js,wxml,wxss,json} |

---

## 三、核心配置

### 3.1 app.json

```json
{
  "pages": [
    "pages/index/index",
    "pages/user-center/index/index",
    "pages/user-center/edit-profile/index",
    "pages/user-center/order-list/index",
    "pages/user-center/publish-list/index",
    "pages/user-center/history-list/index",
    "pages/user-center/service-support/index",
    "pages/user-center/settings/index"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#007AFF",
    "navigationBarTitleText": "旅居服务站",
    "navigationBarTextStyle": "white",
    "backgroundColor": "#F5F5F5"
  },
  "tabBar": {
    "color": "#666666",
    "selectedColor": "#007AFF",
    "backgroundColor": "#FFFFFF",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页",
        "iconPath": "images/tab-home.png",
        "selectedIconPath": "images/tab-home-active.png"
      },
      {
        "pagePath": "pages/user-center/index/index",
        "text": "我的",
        "iconPath": "images/tab-user.png",
        "selectedIconPath": "images/tab-user-active.png"
      }
    ]
  },
  "style": "v2",
  "sitemapLocation": "sitemap.json",
  "lazyCodeLoading": "requiredComponents"
}
```

### 3.2 app.js

```javascript
// app.js
App({
  onLaunch() {
    // 小程序启动时执行
    console.log('小程序启动')
  },

  globalData: {
    userInfo: null,
    theme: 'light',        // 主题：light/dark
    appVersion: 'standard' // 版本：standard/elderly
  },

  // 主题切换
  setTheme(theme) {
    this.globalData.theme = theme
    // 触发主题更新
    const pages = getCurrentPages()
    pages.forEach(page => {
      if (page.onThemeChange) {
        page.onThemeChange(theme)
      }
    })
  },

  // 应用版本切换（老人版）
  setAppVersion(version) {
    this.globalData.appVersion = version
    const pages = getCurrentPages()
    pages.forEach(page => {
      if (page.onAppVersionChange) {
        page.onAppVersionChange(version)
      }
    })
  }
})
```

### 3.3 app.wxss

```css
/** app.wxss **/
page {
  background-color: #F5F5F5;
  font-size: 28rpx;
  line-height: 1.5;
  color: #333;
}

/* 容器 */
.container {
  padding: 20rpx;
}

/* 卡片 */
.card {
  background: #fff;
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 20rpx;
  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);
}

/* 按钮 */
.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 88rpx;
  border-radius: 44rpx;
  font-size: 30rpx;
  background: #007AFF;
  color: #fff;
}

.btn:active {
  opacity: 0.8;
}

/* 输入框 */
.input {
  height: 80rpx;
  padding: 0 20rpx;
  border: 1rpx solid #ddd;
  border-radius: 8rpx;
  font-size: 28rpx;
}

/* 老人版样式 */
page Elderly {
  font-size: 36rpx;
  line-height: 1.8;
}

page Elderly .btn {
  height: 112rpx;
  font-size: 36rpx;
  border-radius: 56rpx;
}

page Elderly .input {
  height: 100rpx;
  font-size: 36rpx;
  padding: 0 30rpx;
}
```

---

## 四、页面详细设计

### 4.1 用户中心首页

**原文件**：`pages/user-center/index.vue`

**目标文件**：`pages/user-center/index/index.{js,wxml,wxss,json}`

#### index.js

```javascript
// pages/user-center/index/index.js
const app = getApp()

Page({
  data: {
    userInfo: null,
    isDarkMode: false,
    isElderlyMode: false,
    stats: {
      postCount: 0,
      orderCount: 0,
      likeCount: 0
    }
  },

  onLoad() {
    this.loadUserInfo()
  },

  onShow() {
    // 每次显示时检查主题设置
    const theme = app.globalData.theme
    const appVersion = app.globalData.appVersion
    this.setData({
      isDarkMode: theme === 'dark',
      isElderlyMode: appVersion === 'elderly'
    })
  },

  loadUserInfo() {
    // 模拟数据，实际应调用 API
    this.setData({
      userInfo: {
        id: '1',
        nickname: '乡村数字游民',
        avatar: '/images/default-avatar.png',
        identity: 'villager',
        bio: '热爱乡村生活，分享旅居体验'
      },
      stats: {
        postCount: 12,
        orderCount: 5,
        likeCount: 88
      }
    })
  },

  // 跳转
  navigateTo(e) {
    const url = e.currentTarget.dataset.url
    wx.navigateTo({ url })
  },

  // 切换主题
  toggleTheme() {
    const newTheme = this.data.isDarkMode ? 'light' : 'dark'
    app.setTheme(newTheme)
    this.setData({ isDarkMode: newTheme === 'dark' })
  }
})
```

#### index.wxml

```html
<!-- pages/user-center/index/index.wxml -->
<view class="user-center {{isDarkMode ? 'dark' : ''}}">
  <!-- 顶部背景 -->
  <view class="user-header" style="background: {{userInfo.background || '#007AFF'}}">
    <view class="user-info">
      <image class="avatar" src="{{userInfo.avatar}}" mode="aspectFill"/>
      <view class="user-detail">
        <text class="nickname">{{userInfo.nickname}}</text>
        <view class="identity-badge">{{userInfo.identity === 'villager' ? '村民' : '游民'}}</view>
      </view>
    </view>
  </view>

  <!-- 统计数据 -->
  <view class="stats-container">
    <view class="stat-item">
      <text class="stat-value">{{stats.postCount}}</text>
      <text class="stat-label">发布</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{stats.orderCount}}</text>
      <text class="stat-label">交易</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{stats.likeCount}}</text>
      <text class="stat-label">获赞</text>
    </view>
  </view>

  <!-- 功能列表 -->
  <view class="menu-list">
    <view class="menu-item" bindtap="navigateTo" data-url="/pages/user-center/order-list/index">
      <text class="menu-title">我的交易</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="navigateTo" data-url="/pages/user-center/publish-list/index">
      <text class="menu-title">我的发布</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="navigateTo" data-url="/pages/user-center/history-list/index">
      <text class="menu-title">我的记录</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="navigateTo" data-url="/pages/user-center/service-support/index">
      <text class="menu-title">服务与支持</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="navigateTo" data-url="/pages/user-center/settings/index">
      <text class="menu-title">设置</text>
      <text class="menu-arrow">›</text>
    </view>
  </view>

  <!-- 主题切换（开发调试用） -->
  <view class="theme-switch">
    <switch checked="{{isDarkMode}}" bindchange="toggleTheme" color="#007AFF"/>
    <text>深色模式</text>
  </view>
</view>
```

#### index.wxss

```css
/* pages/user-center/index/index.wxss */
.user-center {
  min-height: 100vh;
  background: #F5F5F5;
}

.user-center.dark {
  background: #1a1a1a;
}

.user-header {
  height: 400rpx;
  padding: 40rpx;
  display: flex;
  align-items: flex-end;
}

.user-info {
  display: flex;
  align-items: center;
}

.avatar {
  width: 140rpx;
  height: 140rpx;
  border-radius: 50%;
  border: 4rpx solid #fff;
}

.user-detail {
  margin-left: 24rpx;
}

.nickname {
  font-size: 36rpx;
  color: #fff;
  font-weight: bold;
}

.identity-badge {
  display: inline-block;
  margin-top: 8rpx;
  padding: 4rpx 16rpx;
  background: rgba(255,255,255,0.3);
  border-radius: 20rpx;
  font-size: 24rpx;
  color: #fff;
}

.stats-container {
  display: flex;
  background: #fff;
  padding: 30rpx 0;
  margin: -40rpx 20rpx 20rpx;
  border-radius: 16rpx;
  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);
}

.stat-item {
  flex: 1;
  text-align: center;
}

.stat-value {
  display: block;
  font-size: 40rpx;
  font-weight: bold;
  color: #333;
}

.stat-label {
  font-size: 24rpx;
  color: #999;
}

.menu-list {
  margin: 20rpx;
  background: #fff;
  border-radius: 16rpx;
}

.menu-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 30rpx;
  border-bottom: 1rpx solid #f0f0f0;
}

.menu-item:last-child {
  border-bottom: none;
}

.menu-title {
  font-size: 30rpx;
  color: #333;
}

.menu-arrow {
  font-size: 36rpx;
  color: #ccc;
}

.theme-switch {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 40rpx 20rpx;
  padding: 20rpx;
  background: #fff;
  border-radius: 16rpx;
}
```

#### index.json

```json
{
  "navigationBarTitleText": "用户中心",
  "enablePullDownRefresh": false
}
```

---

### 4.2 设置页面

**原文件**：`pages/user-center/settings.vue`

**目标文件**：`pages/user-center/settings/index.{js,wxml,wxss,json}`

```javascript
// pages/user-center/settings/index.js
const app = getApp()

Page({
  data: {
    isDarkMode: false,
    appVersion: 'standard',
    identity: 'villager',
    notificationEnabled: true,
    privacyMode: false
  },

  onLoad() {
    this.loadSettings()
  },

  loadSettings() {
    this.setData({
      isDarkMode: app.globalData.theme === 'dark',
      appVersion: app.globalData.appVersion
    })
  },

  // 切换主题
  toggleTheme(e) {
    const theme = e.detail.value ? 'dark' : 'light'
    app.setTheme(theme)
    this.setData({ isDarkMode: theme === 'dark' })
  },

  // 切换应用版本
  switchVersion(e) {
    const version = e.currentTarget.dataset.version
    app.setAppVersion(version)
    this.setData({ appVersion: version })
    wx.showToast({
      title: version === 'elderly' ? '已切换为老人版' : '已切换为标准版',
      icon: 'success'
    })
  },

  // 编辑资料
  goToEditProfile() {
    wx.navigateTo({
      url: '/pages/user-center/edit-profile/index'
    })
  }
})
```

---

### 4.3 交易列表页面

**原文件**：`pages/user-center/order-list.vue`

**目标文件**：`pages/user-center/order-list/index.{js,wxml,wxss,json}`

```javascript
// pages/user-center/order-list/index.js
Page({
  data: {
    activeTab: 'all',
    orderList: [
      {
        id: '1',
        title: '大理古城民宿',
        image: '/images/house-1.png',
        price: 299,
        status: 'pending',
        createTime: '2026-02-15'
      },
      {
        id: '2',
        title: '摄影跟拍服务',
        image: '/images/skill-1.png',
        price: 500,
        status: 'confirmed',
        createTime: '2026-02-14'
      },
      {
        id: '3',
        title: '洱海一日游',
        image: '/images/activity-1.png',
        price: 188,
        status: 'completed',
        createTime: '2026-02-10'
      }
    ]
  },

  switchTab(e) {
    this.setData({ activeTab: e.currentTarget.dataset.tab })
  },

  confirmOrder(e) {
    const id = e.currentTarget.dataset.id
    wx.showModal({
      title: '确认交易',
      content: '确定要确认这个交易吗？',
      success: (res) => {
        if (res.confirm) {
          const list = this.data.orderList.map(item => {
            if (item.id === id) {
              return { ...item, status: 'confirmed' }
            }
            return item
          })
          this.setData({ orderList: list })
          wx.showToast({ title: '交易已确认', icon: 'success' })
        }
      }
    })
  },

  completeOrder(e) {
    const id = e.currentTarget.dataset.id
    wx.showModal({
      title: '完成交易',
      content: '确认已完成服务吗？',
      success: (res) => {
        if (res.confirm) {
          const list = this.data.orderList.map(item => {
            if (item.id === id) {
              return { ...item, status: 'completed' }
            }
            return item
          })
          this.setData({ orderList: list })
          wx.showToast({ title: '交易已完成', icon: 'success' })
        }
      }
    })
  },

  getStatusText(status) {
    const map = {
      pending: '待确认',
      confirmed: '已确认',
      completed: '已完成',
      cancelled: '已取消'
    }
    return map[status] || status
  }
})
```

---

## 五、组件设计.1 

### 5通用返回按钮组件

**components/back-button/index.{js,wxml,wxss,json}**

```javascript
// components/back-button/index.js
Component({
  properties: {
    text: {
      type: String,
      value: '返回'
    }
  },
  methods: {
    goBack() {
      wx.navigateBack()
    }
  }
})
```

```html
<!-- components/back-button/index.wxml -->
<view class="back-button" bindtap="goBack">
  <text class="back-icon">←</text>
  <text class="back-text">{{text}}</text>
</view>
```

```css
/* components/back-button/index.wxss */
.back-button {
  display: flex;
  align-items: center;
  padding: 20rpx;
}

.back-icon {
  font-size: 40rpx;
  color: #007AFF;
  margin-right: 8rpx;
}

.back-text {
  font-size: 30rpx;
  color: #007AFF;
}
```

---

## 六、样式规范

### 6.1 深色模式

```css
/* app.wxss 添加强制深色 */
page.dark {
  background-color: #1a1a1a;
  color: #f0f0f0;
}

page.dark .card {
  background-color: #2d2d2d;
}

page.dark .menu-item {
  background-color: #2d2d2d;
  border-color: #3a3a3a;
}

page.dark .menu-title,
page.dark .stat-value {
  color: #f0f0f0;
}

page.dark .input {
  background-color: #2d2d2d;
  border-color: #3a3a3a;
  color: #f0f0f0;
}
```

### 6.2 老人版样式

```css
/* app.wxss */
page.elderly {
  font-size: 40rpx !important;
  line-height: 1.8 !important;
}

page.elderly .btn {
  height: 112rpx !important;
  font-size: 40rpx !important;
  border-radius: 56rpx !important;
}

page.elderly .page-title {
  font-size: 48rpx !important;
}

page.elderly .card {
  padding: 40rpx !important;
  margin-bottom: 32rpx !important;
}

page.elderly .menu-item {
  padding: 40rpx !important;
}

page.elderly .menu-title {
  font-size: 36rpx !important;
}

page.elderly .avatar {
  width: 160rpx !important;
  height: 160rpx !important;
}

page.elderly input[type="checkbox"] {
  width: 48rpx !important;
  height: 48rpx !important;
}
```

---

## 七、路由配置

### 7.1 跳转方法

| 场景 | 方法 | 说明 |
|------|------|------|
| 页面跳转 | wx.navigateTo | 有返回按钮 |
| Tab 切换 | wx.switchTab | 底部 Tab |
| 页面返回 | wx.navigateBack | 返回上级 |
| 页面重定向 | wx.redirectTo | 无返回 |

### 7.2 页面栈限制

- `navigateTo` 最多 10 层
- 超过后需要用 `redirectTo`

---

## 八、API 服务层

### 8.1 统一请求封装

```javascript
// utils/request.js
const BASE_URL = 'https://api.lvji.com/v1'

function request(url, method = 'GET', data = {}) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: BASE_URL + url,
      method,
      data,
      header: {
        'Content-Type': 'application/json',
        'Authorization': wx.getStorageSync('token') || ''
      },
      success: (res) => {
        if (res.statusCode === 200) {
          resolve(res.data)
        } else {
          reject(res.data)
        }
      },
      fail: (err) => {
        reject(err)
      }
    })
  })
}

export const get = (url, data) => request(url, 'GET', data)
export const post = (url, data) => request(url, 'POST', data)
export const put = (url, data) => request(url, 'PUT', data)
export const del = (url, data) => request(url, 'DELETE', data)
```

### 8.2 用户 API

```javascript
// services/user.js
import { get, post, put } from '../utils/request'

export const userAPI = {
  getUserInfo: (id) => get(`/users/${id}`),
  updateUserInfo: (id, data) => put(`/users/${id}`, data),
  updateSettings: (id, data) => put(`/users/${id}/settings`, data),
  getOrders: (params) => get('/orders', params),
  getPublishList: (params) => get('/publish', params),
  getHistory: (params) => get('/history', params)
}
```

---

## 九、项目配置文件

### 9.1 project.config.json

```json
{
  "description": "旅居服务站",
  "packOptions": {
    "ignore": [],
    "include": []
  },
  "setting": {
    "bundle": false,
    "userConfirmedBundleSwitch": false,
    "urlCheck": true,
    "scopeDataCheck": false,
    "coverView": true,
    "es6": true,
    "postcss": true,
    "compileHotReLoad": false,
    "lazyloadPlaceholderEnable": false,
    "preloadBackgroundData": false,
    "minified": true,
    "autoAudits": false,
    "newFeature": false,
    "uglifyFileName": false,
    "uploadWithSourceMap": true,
    "useIsolateContext": true,
    "nodeModules": false,
    "enhance": true,
    "useMultiFrameRuntime": true,
    "useApiHook": true,
    "useApiHostProcess": true,
    "showShadowRootInWxmlPanel": true,
    "packNpmManually": false,
    "packNpmRelationList": [],
    "minifyWXSS": true,
    "disableUseStrict": false,
    "minifyWXML": true,
    "showES6CompileOption": false,
    "useCompilerPlugins": false
  },
  "compileType": "miniprogram",
  "libVersion": "3.0.0",
  "appid": "your-appid",
  "projectname": "lvji-service-station",
  "condition": {},
  "editorSetting": {
    "tabIndent": "insertSpaces",
    "tabSize": 2
  }
}
```

---

## 十、重构步骤

### 10.1 第一阶段：基础配置

- [ ] 创建项目目录结构
- [ ] 配置 app.json
- [ ] 配置 app.js
- [ ] 配置 app.wxss 全局样式
- [ ] 配置 project.config.json

### 10.2 第二阶段：用户中心

- [ ] 实现首页（index）
- [ ] 实现设置页面（settings）
- [ ] 实现编辑资料（edit-profile）

### 10.3 第三阶段：功能列表

- [ ] 实现我的交易（order-list）
- [ ] 实现我的发布（publish-list）
- [ ] 实现我的记录（history-list）
- [ ] 实现服务与支持（service-support）

### 10.4 第四阶段：其他模块

- [ ] 实现首页（index）
- [ ] 实现民宿模块
- [ ] 实现技能模块
- [ ] 实现活动模块
- [ ] 实现广场模块
- [ ] 实现消息模块

### 10.5 第五阶段：优化

- [ ] 深色模式适配
- [ ] 老人版适配
- [ ] 性能优化
- [ ] 测试

---

## 十一、注意事项

### 11.1 文件命名

- 所有文件名使用小写
- 目录使用小写字母加连字符
- 组件使用小写字母加连字符

### 11.2 样式隔离

- 页面样式使用 page 根类
- 组件样式使用组件名根类
- 避免使用全局样式污染

### 11.3 数据绑定

- 使用 setData 更新数据
- 避免直接修改 this.data
- 大数据更新使用官方优化方法

---

## 十二、版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2026-02-18 | 初版设计 |

---

**下一步**：确认后开始逐步实现各页面
