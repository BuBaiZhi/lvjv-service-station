# æ—…å±…æœåŠ¡ç«™å°ç¨‹åº - å¼€å‘è¿›åº¦æŠ¥å‘Š

**æ›´æ–°æ—¶é—´**: 2026-02-21
**é¡¹ç›®çŠ¶æ€**: ç™»å½•è®¤è¯æ¨¡å—å¼€å‘ä¸­

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: æ—…å±…æœåŠ¡ç«™å°ç¨‹åº
**æŠ€æœ¯æ ˆ**: å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘ (WXML + WXSS + JavaScript)
**é¡¹ç›®ç›®æ ‡**: è¿æ¥æ‘æ°‘ä¸æ¸¸å®¢çš„æœåŠ¡å¹³å°

---

## äºŒã€å·²å®ŒæˆåŠŸèƒ½

### 2.1 ç™»å½•è®¤è¯æ¨¡å— âœ…

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç™»å½•é¡µé¢ | âœ… å®Œæˆ | å¾®ä¿¡ç™»å½• + æ¸¸å®¢æ¨¡å¼ |
| èº«ä»½é€‰æ‹©é¡µ | âœ… å®Œæˆ | æ‘æ°‘/æ¸¸å®¢èº«ä»½é€‰æ‹© |
| åŒTokenè®¤è¯ | âœ… å®Œæˆ | accessToken + refreshToken |
| ç»Ÿä¸€authModeçŠ¶æ€ | âœ… å®Œæˆ | 'user' / 'guest' / null ä¸‰æ€ |
| æ¸¸å®¢æ¨¡å¼æƒé™éš”ç¦» | âœ… å®Œæˆ | æ¸¸å®¢åªèƒ½æµè§ˆé¦–é¡µ |

**æ ¸å¿ƒæ–‡ä»¶**:
- `pages/login/index.js` - ç™»å½•é€‰æ‹©é¡µ
- `pages/login/identity/index.js` - èº«ä»½é€‰æ‹©é¡µ
- `services/auth.js` - è®¤è¯æœåŠ¡
- `services/http.js` - HTTPæ‹¦æˆªå™¨ï¼ˆåŒToken + 401è‡ªåŠ¨åˆ·æ–°ï¼‰
- `utils/auth.js` - ç»Ÿä¸€è®¤è¯å·¥å…·ï¼ˆå¾…å®Œå–„ï¼‰

### 2.2 ç”¨æˆ·ä¸­å¿ƒæ¨¡å— âœ…

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æœªç™»å½•çŠ¶æ€æ˜¾ç¤º | âœ… å®Œæˆ | ç©ºç™½å¤´åƒ + ç™»å½•æŒ‰é’® |
| å·²ç™»å½•çŠ¶æ€æ˜¾ç¤º | âœ… å®Œæˆ | ç”¨æˆ·å¡ç‰‡ + ç»Ÿè®¡æ•°æ® |
| èœå•æƒé™æ§åˆ¶ | âœ… å®Œæˆ | æœªç™»å½•/æ¸¸å®¢ç‚¹å‡»æç¤º |
| ç¼–è¾‘èµ„æ–™å…¥å£ | âœ… å®Œæˆ | è·³è½¬ç¼–è¾‘é¡µ |

**æ ¸å¿ƒæ–‡ä»¶**:
- `pages/user-center/index/index.js` - ç”¨æˆ·ä¸­å¿ƒé¦–é¡µ
- `pages/user-center/index/index.wxml` - ç”¨æˆ·ä¸­å¿ƒæ¨¡æ¿
- `pages/user-center/index/index.wxss` - ç”¨æˆ·ä¸­å¿ƒæ ·å¼

### 2.3 é¦–é¡µæ¨¡å— âœ…

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è®¤è¯æ£€æŸ¥ | âœ… å®Œæˆ | æœªç™»å½•è·³è½¬ç™»å½•é¡µ |
| ä¸»é¢˜åŒæ­¥ | âœ… å®Œæˆ | onLoad + onShow åŒæ­¥ |

### 2.4 æ·±è‰²æ¨¡å¼ âœ…

| åŠŸèƒ½ | çŠ¶æ€ |è¯´æ˜ |
|------|------|------|
| CSSå˜é‡ç³»ç»Ÿ | âœ… å®Œæˆ | ä¸»é¢˜å˜é‡å®šä¹‰ |
| é¡µé¢çº§ä¸»é¢˜åˆ‡æ¢ | âœ… å®Œæˆ | light/dark/elderly ä¸‰å¥— |
| ä¸»é¢˜å˜é‡ç”Ÿæ•ˆä¿®å¤ | âœ… å®Œæˆ | æ˜¾å¼æ·»åŠ  light class |

---

## ä¸‰ã€é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 3.1 ç™»å½•è®¤è¯æ¶æ„é—®é¢˜

**é—®é¢˜**: çŠ¶æ€æºå››é‡å‰²è£‚ï¼ˆstorage / globalData / é¡µé¢data / é€»è¾‘åˆ¤æ–­ï¼‰

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ä½¿ç”¨ `authMode` å­—æ®µ
```javascript
// ä¿®å¤å‰
accessToken: æœ‰/æ— 
isGuest: true/undefined
isLogin: true/undefined

// ä¿®å¤å
authMode: 'user' | 'guest' | null
```

### 3.2 tabBaré¡µé¢è·³è½¬é—®é¢˜

**é—®é¢˜**: é¦–é¡µæ˜¯tabBaré¡µé¢ï¼Œä½¿ç”¨redirectToè·³è½¬å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**: tabBaré¡µé¢ä½¿ç”¨ switchTab
```javascript
wx.switchTab({ url: '/pages/index/index' })  // âœ…
wx.redirectTo({ url: '/pages/index/index' })  // âŒ
```

### 3.3 servicesæ¨¡å—åŠ è½½é”™è¯¯

**é—®é¢˜**: services/http.js åœ¨æ¨¡å—é¡¶å±‚è°ƒç”¨ getApp() å¯¼è‡´åˆå§‹åŒ–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**: å»¶è¿Ÿè·å– app å®ä¾‹
```javascript
// ä¿®å¤å‰
const app = getApp()  // æ¨¡å—åŠ è½½æ—¶æ‰§è¡Œ âŒ

// ä¿®å¤å
function getAppData() {
  return getApp()  // å‡½æ•°å†…éƒ¨è°ƒç”¨ âœ…
}
```

### 3.4 ä¸»é¢˜å˜é‡ä¸ç”Ÿæ•ˆ

**é—®é¢˜**: page class æ²¡æœ‰æ˜¾å¼æ·»åŠ  light ç±»

**è§£å†³æ–¹æ¡ˆ**: WXML ä¸­æ˜¾å¼åˆ¤æ–­ theme çŠ¶æ€
```xml
<!-- ä¿®å¤å‰ -->
<view class="page {{theme === 'dark' ? 'dark-mode' : ''}}">

<!-- ä¿®å¤å -->
<view class="page {{theme === 'dark' ? 'dark-mode' : (theme === 'light' ? 'light' : '')}}">
```

### 3.5 UIç‚¹å‡»å¤±æ•ˆé—®é¢˜

**é—®é¢˜**: imageç»„ä»¶srcä¸ºç©ºå¯¼è‡´æ¸²æŸ“å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨view+emojiæ›¿ä»£ç©ºimage
```xml
<!-- ä¿®å¤å‰ -->
<image src="">  <!-- å¯¼è‡´500é”™è¯¯ -->

<!-- ä¿®å¤å -->
<view class="login-avatar-placeholder">ğŸ‘¤</view>
```

---

## å››ã€å½“å‰å¾…è§£å†³é—®é¢˜

### 4.1 ç™»å½•æŒ‰é’®ç‚¹å‡»é—®é¢˜

**ç°è±¡**: ç‚¹å‡»"ç™»å½•/æ³¨å†Œ"æŒ‰é’®æ— ååº”

**å·²å°è¯•ä¿®å¤**:
1. âœ… ä¿®å¤servicesæ¨¡å—getAppé—®é¢˜
2. âœ… ä¿®å¤ä¸»é¢˜å˜é‡light class
3. âœ… ç§»é™¤ç©ºimageç»„ä»¶
4. âœ… menu-sectionæ¡ä»¶æ¸²æŸ“é¿å…è¦†ç›–

**çŠ¶æ€**: ğŸ”„ æµ‹è¯•ä¸­

### 4.2 æ¸¸å®¢æ¨¡å¼çŠ¶æ€æŒä¹…åŒ–

**å¾…å®Œå–„**: åˆ·æ–°é¡µé¢åæ¸¸å®¢çŠ¶æ€æ¢å¤é€»è¾‘

---

## äº”ã€æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶
```
utils/auth.js          - ç»Ÿä¸€è®¤è¯å·¥å…·ï¼ˆå¾…å®Œå–„ï¼‰
```

### ä¿®æ”¹æ–‡ä»¶
```
app.js                 - authModeç»Ÿä¸€çŠ¶æ€ç®¡ç†
app.json               - ç§»é™¤éæ³•themeConfigå­—æ®µ
pages/login/index.js   - ç™»å½•æµç¨‹ + æ¨¡æ‹Ÿæ¨¡å¼
pages/login/identity/index.js - èº«ä»½é€‰æ‹©
pages/index/index.js   - è®¤è¯æ£€æŸ¥
pages/user-center/index/index.js - ç”¨æˆ·ä¸­å¿ƒé‡æ„
pages/user-center/index/index.wxml - æ¡ä»¶æ¸²æŸ“
pages/user-center/index/index.wxss - æœªç™»å½•æ ·å¼
services/http.js       - å»¶è¿Ÿè·å–app
```

---

## å…­ã€ä¸‹ä¸€æ­¥è®¡åˆ’

### ä¼˜å…ˆçº§ï¼šé«˜
1. âœ… ç™»å½•æŒ‰é’®ç‚¹å‡»é—®é¢˜æœ€ç»ˆä¿®å¤
2. âœ… æ¸¸å®¢æ¨¡å¼çŠ¶æ€æ¢å¤æµ‹è¯•
3. âœ… å®Œæ•´ç™»å½•æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•

### ä¼˜å…ˆçº§ï¼šä¸­
4. ğŸ”² å®Œå–„ utils/auth.js ç»Ÿä¸€è®¤è¯å·¥å…·
5. ğŸ”² å…¶ä»–é¡µé¢æ¥å…¥ç»Ÿä¸€è®¤è¯
6. ğŸ”² æ‰‹æœºå·ç™»å½•åŠŸèƒ½å¼€å‘

### ä¼˜å…ˆçº§ï¼šä½
7. ğŸ”² æ€§èƒ½ä¼˜åŒ–
8. ğŸ”² å•å…ƒæµ‹è¯•

---

## ä¸ƒã€æŠ€æœ¯è§„èŒƒæ€»ç»“

### 7.1 è®¤è¯çŠ¶æ€æ¨¡å‹
```javascript
// å”¯ä¸€è®¤è¯çŠ¶æ€å­—æ®µ
authMode: 'user' | 'guest' | null

// å­˜å‚¨ä½ç½®
wx.setStorageSync('authMode', 'user')

// é¡µé¢æ£€æŸ¥
const authMode = wx.getStorageSync('authMode')
if (!authMode) {  // æœªç™»å½• }
if (authMode === 'guest') {  // æ¸¸å®¢ }
if (authMode === 'user') {  // å·²ç™»å½•ç”¨æˆ· }
```

### 7.2 ä¸»é¢˜å˜é‡è§„èŒƒ
```css
/* WXML å¿…é¡»æ˜¾å¼å£°æ˜ light class */
<view class="page light"> æˆ–
<view class="page {{theme === 'light' ? 'light' : ''}}">
```

### 7.3 tabBarè·³è½¬è§„èŒƒ
```javascript
// tabBaré¡µé¢è·³è½¬
wx.switchTab({ url: '/pages/index/index' })

// æ™®é€šé¡µé¢è·³è½¬
wx.navigateTo({ url: '/pages/login/index' })
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.2.0
**ä¸‹æ¬¡æ›´æ–°**: é—®é¢˜ä¿®å¤å®Œæˆå
