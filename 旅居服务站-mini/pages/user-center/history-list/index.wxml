<!-- æµè§ˆå†å²é¡µé¢ -->
<view class="page {{theme === 'dark' ? 'dark-mode' : ''}} {{appVersion === 'elderly' ? 'elderly-mode' : ''}}">
  <!-- å¯¼èˆªæ  -->
  <view class="page-header">
    <view class="back-btn" bindtap="goBack">è¿”å›</view>
    <text class="page-title">æµè§ˆå†å²</text>
    <text class="edit-btn" bindtap="toggleEditMode">
      {{isEditMode ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}}
    </text>
  </view>

  <!-- å†å²åˆ—è¡¨ -->
  <view class="content">
    <view 
      class="history-card {{isEditMode ? 'edit-mode' : ''}}"
      wx:for="{{historyList}}"
      wx:key="id"
      bindtap="viewDetail"
      data-id="{{item.id}}"
    >
      <!-- ç¼–è¾‘æ¨¡å¼é€‰æ‹©æ¡† -->
      <view 
        class="checkbox {{selectedIds.indexOf(item.id) > -1 ? 'checked' : ''}}"
        wx:if="{{isEditMode}}"
        catchtap="toggleSelect"
        data-id="{{item.id}}"
      >
        <text wx:if="{{selectedIds.indexOf(item.id) > -1}}">âœ“</text>
      </view>

      <image class="history-image" src="{{item.image}}" mode="aspectFill"></image>
      
      <view class="history-info">
        <text class="history-title">{{item.title}}</text>
        <text class="history-type">
          {{item.type === 'house' ? 'æ°‘å®¿' : item.type === 'skill' ? 'æŠ€èƒ½' : 'æ´»åŠ¨'}}
        </text>
        <view class="history-footer">
          <text class="history-price">Â¥{{item.price}}</text>
          <text class="history-date">{{item.date}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{historyList.length === 0}}">
      <text class="empty-icon">ğŸ•</text>
      <text class="empty-text">æš‚æ— æµè§ˆè®°å½•</text>
    </view>
  </view>

  <!-- ç¼–è¾‘æ¨¡å¼åº•éƒ¨æ“ä½œæ  -->
  <view class="edit-bar" wx:if="{{isEditMode}}">
    <view class="edit-actions">
      <text class="action-text" bindtap="selectAll">å…¨é€‰</text>
      <text class="action-text delete" bindtap="deleteSelected">
        åˆ é™¤{{selectedIds.length > 0 ? '(' + selectedIds.length + ')' : ''}}
      </text>
    </view>
  </view>
</view>
