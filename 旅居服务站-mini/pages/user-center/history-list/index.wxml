<!-- æµè§ˆå†å²é¡µé¢ -->
<view class="page {{theme === 'dark' ? 'dark-mode' : ''}} {{appVersion === 'elderly' ? 'elderly-mode' : ''}}">

  <!-- æ ‡ç­¾æ ï¼šæµè§ˆ/æ”¶è— -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'history' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="history">
      æµè§ˆ
    </view>
    <view 
      class="tab-item {{activeTab === 'favorite' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="favorite">
      æ”¶è—
    </view>
  </view>

  <!-- ç±»å‹ç­›é€‰ -->
  <view class="filter-bar">
    <view class="filter-btn" bindtap="toggleTypeFilter">
      {{ currentTypeFilter === 'all' ? 'å…¨éƒ¨' :
         currentTypeFilter === 'house' ? 'æ°‘å®¿' :
         currentTypeFilter === 'activity' ? 'æ´»åŠ¨' :
         currentTypeFilter === 'skill' ? 'æŠ€èƒ½' :
         'åˆ†äº«' }}
      <text class="arrow {{typeFilterShow ? 'up' : ''}}">â–¼</text>
    </view>
  </view>

  <!-- ä¸‹æ‹‰é®ç½© -->
  <view wx:if="{{typeFilterShow}}" class="mask" bindtap="closeTypeFilter">
    <view class="dropdown" catchtap="noop">
      <view 
        class="dropdown-item {{currentTypeFilter === item.value ? 'active' : ''}}"
        wx:for="{{typeOptions}}"
        wx:key="value"
        data-type="{{item.value}}"
        bindtap="toggleTypeFilter">
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- å†å²åˆ—è¡¨ -->
  <view class="content">
    <view 
      class="history-card"
      wx:for="{{filteredList}}"
      wx:key="id"
    >
      <image class="history-image" src="{{item.image}}" mode="aspectFill"></image>
      
      <view class="history-info">
        <text class="history-title">{{item.title}}</text>
        <text class="history-type">
          {{item.type === 'house' ? 'æ°‘å®¿' : item.type === 'activity' ? 'æ´»åŠ¨' : item.type === 'skill' ? 'æŠ€èƒ½' : 'åˆ†äº«'}}
        </text>
        <view class="history-footer">
          <text class="history-price">Â¥{{item.price}}</text>
          <text class="history-date">{{item.date}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{filteredList.length === 0}}">
      <text class="empty-icon">ğŸ•</text>
      <text class="empty-text">{{activeTab === 'history' ? 'æš‚æ— æµè§ˆè®°å½•' : 'æš‚æ— æ”¶è—'}}</text>
    </view>
  </view>
</view>
